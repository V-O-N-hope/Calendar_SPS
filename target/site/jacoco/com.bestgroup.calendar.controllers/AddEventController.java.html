<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AddEventController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Calendar</a> &gt; <a href="index.source.html" class="el_package">com.bestgroup.calendar.controllers</a> &gt; <span class="el_source">AddEventController.java</span></div><h1>AddEventController.java</h1><pre class="source lang-java linenums">package com.bestgroup.calendar.controllers;

import com.bestgroup.calendar.AppHelper;
import com.bestgroup.calendar.CurrentTime;
import com.bestgroup.calendar.Notifications;
import javafx.scene.Node;
import javafx.scene.control.TextField;
import javafx.fxml.FXML;
import javafx.scene.control.Button;
import javafx.scene.control.DatePicker;

import java.io.*;
import java.time.LocalDate;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;
import java.time.format.DateTimeParseException;
import java.util.Objects;

import com.bestgroup.calendar.animations.Shake;

import org.apache.poi.hssf.usermodel.*;
import org.apache.poi.ss.usermodel.*;

/**
 * Controller for AddEvent.fxml
 *
 * @author l9sik
 * @author eviv2206
 */
<span class="nc" id="L30">public class AddEventController {</span>

	@FXML
	private Button addEventCancelButton;
	@FXML
	private Button mainMenuSettingsButton;

	@FXML
	private Button addEventButton;

    /**
     * The Text data.
     */
    @FXML
	public DatePicker textData;

    /**
     * The Text description.
     */
    @FXML
	public TextField textDescription;

    /**
     * The Text theme.
     */
    @FXML
	public TextField textTheme;

    /**
     * The Text time notification.
     */
    @FXML
	public TextField textTimeNotification;

	private static final String DATA_FORMAT = &quot;yyyy-MM-dd&quot;;
    /**
     * The Notific.
     */
<span class="nc" id="L68">    final Notifications notific = new Notifications();</span>


    /**
     * Initialize.
     */
    @FXML
	void initialize() {
<span class="nc" id="L76">		setInitialTextData();</span>
<span class="nc" id="L77">		NewScene nw = new NewScene();</span>
<span class="nc" id="L78">		addEventCancelButton.setOnAction(actionEvent -&gt; {</span>
<span class="nc" id="L79">			nw.closeScene(addEventButton);</span>
<span class="nc" id="L80">			nw.openNewScene(&quot;/com/bestgroup/calendar/MainMenu.fxml&quot;);</span>
<span class="nc" id="L81">		});</span>

<span class="nc" id="L83">		mainMenuSettingsButton.setOnAction(actionEvent -&gt; {</span>
<span class="nc" id="L84">			nw.closeScene(addEventButton);</span>
<span class="nc" id="L85">			nw.openNewScene(&quot;/com/bestgroup/calendar/Settings.fxml&quot;);</span>
<span class="nc" id="L86">		});</span>

<span class="nc" id="L88">		addEventButton.setOnAction(actionEvent -&gt; {</span>
			boolean isCorrect;
<span class="nc" id="L90">			resetStyles();</span>
<span class="nc" id="L91">			setStyles();</span>
<span class="nc" id="L92">			isCorrect = isStylesApplied();</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">			if (!isCorrect) {</span>
<span class="nc" id="L94">				nw.openNewScene(&quot;/com/bestgroup/calendar/FailedWriting.fxml&quot;);</span>
			} else {
<span class="nc" id="L96">				writeToFile();</span>
<span class="nc" id="L97">				writeIntoExcel();</span>
<span class="nc" id="L98">				nw.closeScene(addEventButton);</span>
<span class="nc" id="L99">				nw.openNewScene(&quot;/com/bestgroup/calendar/SuccessWriting.fxml&quot;);</span>
<span class="nc" id="L100">				notific.displayTray(textTheme.getText(), &quot;Successfully added&quot;);</span>
			}
<span class="nc" id="L102">		});</span>

<span class="nc" id="L104">	}</span>

	/**
	 * Method resets styles of Node that had been used
	 */
	private void resetStyles() {
<span class="nc" id="L110">		String borderNone = &quot;-fx-border-color: none&quot;;</span>
<span class="nc" id="L111">		textTheme.setStyle(borderNone);</span>
<span class="nc" id="L112">		textDescription.setStyle(borderNone);</span>
<span class="nc" id="L113">		textTimeNotification.setStyle(borderNone);</span>
<span class="nc" id="L114">		textData.setStyle(borderNone);</span>
<span class="nc" id="L115">	}</span>

	/**
	 * @return True if all fields had been filled
	 */
	private Boolean isStylesApplied() {
<span class="nc bnc" id="L121" title="All 2 branches missed.">		boolean isCorrect = textTheme.getLength() &gt;= 1;</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">		if (textDescription.getLength() &lt; 1) {</span>
<span class="nc" id="L123">			isCorrect = false;</span>
		}
<span class="nc" id="L125">		String timeNotification = textTimeNotification.getText();</span>
		try {
<span class="nc" id="L127">			LocalTime.parse(timeNotification);</span>
<span class="nc" id="L128">		} catch (DateTimeParseException | NullPointerException e) {</span>
<span class="nc" id="L129">			isCorrect = false;</span>
<span class="nc" id="L130">		}</span>
		try {
<span class="nc" id="L132">			textData.getValue().format(DateTimeFormatter.ofPattern(DATA_FORMAT));</span>
<span class="nc" id="L133">		} catch (NullPointerException e) {</span>
<span class="nc" id="L134">			isCorrect = false;</span>
<span class="nc" id="L135">		}</span>
<span class="nc" id="L136">		return isCorrect;</span>
	}

	/**
	 * Sets red border and use shake method when field filled incorrectly
	 * @see Shake#Shake(Node) 
	 */
	private void setStyles() {
<span class="nc" id="L144">		String borderRed = &quot;-fx-border-color: red&quot;;</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">		if (textTheme.getLength() &lt; 1) {</span>
<span class="nc" id="L146">			textTheme.setStyle(borderRed);</span>
<span class="nc" id="L147">			Shake textThemeAnim = new Shake(textTheme);</span>
<span class="nc" id="L148">			textThemeAnim.playAnim();</span>
		}
<span class="nc bnc" id="L150" title="All 2 branches missed.">		if (textDescription.getLength() &lt; 1) {</span>
<span class="nc" id="L151">			textDescription.setStyle(borderRed);</span>
<span class="nc" id="L152">			Shake textDescriptionAnim = new Shake(textDescription);</span>
<span class="nc" id="L153">			textDescriptionAnim.playAnim();</span>
		}
<span class="nc" id="L155">		String timeNotification = textTimeNotification.getText();</span>
		try {
<span class="nc" id="L157">			LocalTime.parse(timeNotification);</span>
<span class="nc" id="L158">		} catch (DateTimeParseException | NullPointerException e) {</span>
<span class="nc" id="L159">			textTimeNotification.setPromptText(&quot;Пример: 09:30&quot;);</span>
<span class="nc" id="L160">			textTimeNotification.setStyle(borderRed);</span>
<span class="nc" id="L161">			Shake textTimeNotificationAnim = new Shake(textTimeNotification);</span>
<span class="nc" id="L162">			textTimeNotificationAnim.playAnim();</span>
<span class="nc" id="L163">		}</span>
		try {
<span class="nc" id="L165">			textData.getValue().format(DateTimeFormatter.ofPattern(DATA_FORMAT));</span>
<span class="nc" id="L166">		} catch (NullPointerException e) {</span>
<span class="nc" id="L167">			textData.setStyle(borderRed);</span>
<span class="nc" id="L168">			Shake textDataAnim = new Shake(textData);</span>
<span class="nc" id="L169">			textDataAnim.playAnim();</span>
<span class="nc" id="L170">		}</span>
<span class="nc" id="L171">	}</span>

	/**
	 * Writes event Events.txt file
	 */
	private void writeToFile() {
<span class="nc" id="L177">		File log = new File(&quot;Events.txt&quot;);</span>
		try {
<span class="nc bnc" id="L179" title="All 2 branches missed.">			if (!log.exists()) {</span>
<span class="nc" id="L180">				System.out.println(&quot;We had to make a new file.&quot;);</span>
<span class="nc" id="L181">				System.out.println(log.createNewFile());</span>
			} else {
<span class="nc" id="L183">				FileWriter fileWriter = new FileWriter(log, true);</span>
<span class="nc" id="L184">				try (BufferedWriter bw = new BufferedWriter(fileWriter)) {</span>
<span class="nc" id="L185">					bw.write(textData.getValue().format(DateTimeFormatter.ofPattern(DATA_FORMAT)) + &quot;\n&quot;);</span>
<span class="nc" id="L186">					bw.write(textTheme.getText() + &quot;\n&quot;);</span>
<span class="nc" id="L187">					bw.write(textDescription.getText() + &quot;\n&quot;);</span>
<span class="nc" id="L188">					bw.write(textTimeNotification.getText() + &quot;\n&quot;);</span>
<span class="nc" id="L189">					bw.newLine();</span>
				}
			}
<span class="nc" id="L192">		} catch (IOException e) {</span>
<span class="nc" id="L193">			System.err.println(e.getMessage());</span>
<span class="nc" id="L194">		}</span>
<span class="nc" id="L195">	}</span>

	/**
	 * Writes event in Events.xls file
	 */
	private void writeIntoExcel() {
		try {
<span class="nc" id="L202">			File log = new File(&quot;Events.xls&quot;);</span>
<span class="nc" id="L203">			try (FileInputStream file = new FileInputStream(log)) {</span>
<span class="nc" id="L204">				try (HSSFWorkbook wb = new HSSFWorkbook(file)) {</span>
<span class="nc" id="L205">					HSSFSheet sheet = wb.getSheet(&quot;Events&quot;);</span>
<span class="nc" id="L206">					Row row = sheet.createRow(sheet.getLastRowNum() + 1);</span>
<span class="nc" id="L207">					Cell date = row.createCell(0);</span>
<span class="nc" id="L208">					DataFormat format = wb.createDataFormat();</span>
<span class="nc" id="L209">					CellStyle dateStyle = wb.createCellStyle();</span>
<span class="nc" id="L210">					dateStyle.setDataFormat(format.getFormat(&quot;yyyy-MM-dd&quot;));</span>
<span class="nc" id="L211">					date.setCellStyle(dateStyle);</span>
<span class="nc" id="L212">					date.setCellValue(textData.getValue().format(DateTimeFormatter.ofPattern(DATA_FORMAT)));</span>
<span class="nc" id="L213">					sheet.autoSizeColumn(0);</span>

<span class="nc" id="L215">					Cell theme = row.createCell(1);</span>
<span class="nc" id="L216">					theme.setCellValue(textTheme.getText());</span>
<span class="nc" id="L217">					sheet.autoSizeColumn(1);</span>

<span class="nc" id="L219">					Cell description = row.createCell(2);</span>
<span class="nc" id="L220">					description.setCellValue(textDescription.getText());</span>
<span class="nc" id="L221">					sheet.autoSizeColumn(2);</span>

<span class="nc" id="L223">					Cell time = row.createCell(3);</span>
<span class="nc" id="L224">					time.setCellValue(textTimeNotification.getText());</span>
<span class="nc" id="L225">					sheet.autoSizeColumn(3);</span>

<span class="nc" id="L227">					FileOutputStream out = new FileOutputStream(log);</span>
<span class="nc" id="L228">					wb.write(out);</span>
<span class="nc" id="L229">					out.close();</span>
				}
			}
<span class="nc" id="L232">		} catch (IOException e) {</span>
<span class="nc" id="L233">			System.out.println(&quot;Something wrong with excel file&quot;);</span>
<span class="nc" id="L234">		}</span>
<span class="nc" id="L235">	}</span>

	/**
	 * Sets initial text to the fields
	 */
	private void setInitialTextData() {
		try {
<span class="nc bnc" id="L242" title="All 2 branches missed.">			if (!Objects.isNull(AppHelper.getFullDate())) {</span>
<span class="nc" id="L243">				textData.setValue(LocalDate.parse(AppHelper.getFullDate()));</span>
			}
<span class="nc" id="L245">		} catch (NumberFormatException e) {</span>
<span class="nc" id="L246">			System.out.println(e.getMessage());</span>
<span class="nc" id="L247">		}</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">		if (!Objects.isNull(CurrentTime.getCurrentDate())) {</span>
<span class="nc" id="L249">			textData.setValue(LocalDate.parse(CurrentTime.getCurrentDate()));</span>
		}
<span class="nc" id="L251">	}</span>
}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>